<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Source of the Rust file `foundationdb/src/transaction.rs`."><meta name="keywords" content="rust, rustlang, rust-lang"><title>transaction.rs - source</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" href="../../normalize.css"><link rel="stylesheet" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" href="../../ayu.css" disabled><link rel="stylesheet" href="../../dark.css" disabled><link rel="stylesheet" href="../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../storage.js"></script><script defer src="../../source-script.js"></script><script defer src="../../source-files.js"></script><script defer src="../../main.js"></script><noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../favicon.svg"></head><body class="rustdoc source"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../foundationdb/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></div></a><h2 class="location"></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../../foundationdb/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></div></a></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../../foundationdb/index.html"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></a><nav class="sub"><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><button type="button">?</button></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../wheel.svg"></a></div></div></form></nav></div><section id="main-content" class="content"><div class="example-wrap"><pre class="line-numbers"><span id="1">1</span>
<span id="2">2</span>
<span id="3">3</span>
<span id="4">4</span>
<span id="5">5</span>
<span id="6">6</span>
<span id="7">7</span>
<span id="8">8</span>
<span id="9">9</span>
<span id="10">10</span>
<span id="11">11</span>
<span id="12">12</span>
<span id="13">13</span>
<span id="14">14</span>
<span id="15">15</span>
<span id="16">16</span>
<span id="17">17</span>
<span id="18">18</span>
<span id="19">19</span>
<span id="20">20</span>
<span id="21">21</span>
<span id="22">22</span>
<span id="23">23</span>
<span id="24">24</span>
<span id="25">25</span>
<span id="26">26</span>
<span id="27">27</span>
<span id="28">28</span>
<span id="29">29</span>
<span id="30">30</span>
<span id="31">31</span>
<span id="32">32</span>
<span id="33">33</span>
<span id="34">34</span>
<span id="35">35</span>
<span id="36">36</span>
<span id="37">37</span>
<span id="38">38</span>
<span id="39">39</span>
<span id="40">40</span>
<span id="41">41</span>
<span id="42">42</span>
<span id="43">43</span>
<span id="44">44</span>
<span id="45">45</span>
<span id="46">46</span>
<span id="47">47</span>
<span id="48">48</span>
<span id="49">49</span>
<span id="50">50</span>
<span id="51">51</span>
<span id="52">52</span>
<span id="53">53</span>
<span id="54">54</span>
<span id="55">55</span>
<span id="56">56</span>
<span id="57">57</span>
<span id="58">58</span>
<span id="59">59</span>
<span id="60">60</span>
<span id="61">61</span>
<span id="62">62</span>
<span id="63">63</span>
<span id="64">64</span>
<span id="65">65</span>
<span id="66">66</span>
<span id="67">67</span>
<span id="68">68</span>
<span id="69">69</span>
<span id="70">70</span>
<span id="71">71</span>
<span id="72">72</span>
<span id="73">73</span>
<span id="74">74</span>
<span id="75">75</span>
<span id="76">76</span>
<span id="77">77</span>
<span id="78">78</span>
<span id="79">79</span>
<span id="80">80</span>
<span id="81">81</span>
<span id="82">82</span>
<span id="83">83</span>
<span id="84">84</span>
<span id="85">85</span>
<span id="86">86</span>
<span id="87">87</span>
<span id="88">88</span>
<span id="89">89</span>
<span id="90">90</span>
<span id="91">91</span>
<span id="92">92</span>
<span id="93">93</span>
<span id="94">94</span>
<span id="95">95</span>
<span id="96">96</span>
<span id="97">97</span>
<span id="98">98</span>
<span id="99">99</span>
<span id="100">100</span>
<span id="101">101</span>
<span id="102">102</span>
<span id="103">103</span>
<span id="104">104</span>
<span id="105">105</span>
<span id="106">106</span>
<span id="107">107</span>
<span id="108">108</span>
<span id="109">109</span>
<span id="110">110</span>
<span id="111">111</span>
<span id="112">112</span>
<span id="113">113</span>
<span id="114">114</span>
<span id="115">115</span>
<span id="116">116</span>
<span id="117">117</span>
<span id="118">118</span>
<span id="119">119</span>
<span id="120">120</span>
<span id="121">121</span>
<span id="122">122</span>
<span id="123">123</span>
<span id="124">124</span>
<span id="125">125</span>
<span id="126">126</span>
<span id="127">127</span>
<span id="128">128</span>
<span id="129">129</span>
<span id="130">130</span>
<span id="131">131</span>
<span id="132">132</span>
<span id="133">133</span>
<span id="134">134</span>
<span id="135">135</span>
<span id="136">136</span>
<span id="137">137</span>
<span id="138">138</span>
<span id="139">139</span>
<span id="140">140</span>
<span id="141">141</span>
<span id="142">142</span>
<span id="143">143</span>
<span id="144">144</span>
<span id="145">145</span>
<span id="146">146</span>
<span id="147">147</span>
<span id="148">148</span>
<span id="149">149</span>
<span id="150">150</span>
<span id="151">151</span>
<span id="152">152</span>
<span id="153">153</span>
<span id="154">154</span>
<span id="155">155</span>
<span id="156">156</span>
<span id="157">157</span>
<span id="158">158</span>
<span id="159">159</span>
<span id="160">160</span>
<span id="161">161</span>
<span id="162">162</span>
<span id="163">163</span>
<span id="164">164</span>
<span id="165">165</span>
<span id="166">166</span>
<span id="167">167</span>
<span id="168">168</span>
<span id="169">169</span>
<span id="170">170</span>
<span id="171">171</span>
<span id="172">172</span>
<span id="173">173</span>
<span id="174">174</span>
<span id="175">175</span>
<span id="176">176</span>
<span id="177">177</span>
<span id="178">178</span>
<span id="179">179</span>
<span id="180">180</span>
<span id="181">181</span>
<span id="182">182</span>
<span id="183">183</span>
<span id="184">184</span>
<span id="185">185</span>
<span id="186">186</span>
<span id="187">187</span>
<span id="188">188</span>
<span id="189">189</span>
<span id="190">190</span>
<span id="191">191</span>
<span id="192">192</span>
<span id="193">193</span>
<span id="194">194</span>
<span id="195">195</span>
<span id="196">196</span>
<span id="197">197</span>
<span id="198">198</span>
<span id="199">199</span>
<span id="200">200</span>
<span id="201">201</span>
<span id="202">202</span>
<span id="203">203</span>
<span id="204">204</span>
<span id="205">205</span>
<span id="206">206</span>
<span id="207">207</span>
<span id="208">208</span>
<span id="209">209</span>
<span id="210">210</span>
<span id="211">211</span>
<span id="212">212</span>
<span id="213">213</span>
<span id="214">214</span>
<span id="215">215</span>
<span id="216">216</span>
<span id="217">217</span>
<span id="218">218</span>
<span id="219">219</span>
<span id="220">220</span>
<span id="221">221</span>
<span id="222">222</span>
<span id="223">223</span>
<span id="224">224</span>
<span id="225">225</span>
<span id="226">226</span>
<span id="227">227</span>
<span id="228">228</span>
<span id="229">229</span>
<span id="230">230</span>
<span id="231">231</span>
<span id="232">232</span>
<span id="233">233</span>
<span id="234">234</span>
<span id="235">235</span>
<span id="236">236</span>
<span id="237">237</span>
<span id="238">238</span>
<span id="239">239</span>
<span id="240">240</span>
<span id="241">241</span>
<span id="242">242</span>
<span id="243">243</span>
<span id="244">244</span>
<span id="245">245</span>
<span id="246">246</span>
<span id="247">247</span>
<span id="248">248</span>
<span id="249">249</span>
<span id="250">250</span>
<span id="251">251</span>
<span id="252">252</span>
<span id="253">253</span>
<span id="254">254</span>
<span id="255">255</span>
<span id="256">256</span>
<span id="257">257</span>
<span id="258">258</span>
<span id="259">259</span>
<span id="260">260</span>
<span id="261">261</span>
<span id="262">262</span>
<span id="263">263</span>
<span id="264">264</span>
<span id="265">265</span>
<span id="266">266</span>
<span id="267">267</span>
<span id="268">268</span>
<span id="269">269</span>
<span id="270">270</span>
<span id="271">271</span>
<span id="272">272</span>
<span id="273">273</span>
<span id="274">274</span>
<span id="275">275</span>
<span id="276">276</span>
<span id="277">277</span>
<span id="278">278</span>
<span id="279">279</span>
<span id="280">280</span>
<span id="281">281</span>
<span id="282">282</span>
<span id="283">283</span>
<span id="284">284</span>
<span id="285">285</span>
<span id="286">286</span>
<span id="287">287</span>
<span id="288">288</span>
<span id="289">289</span>
<span id="290">290</span>
<span id="291">291</span>
<span id="292">292</span>
<span id="293">293</span>
<span id="294">294</span>
<span id="295">295</span>
<span id="296">296</span>
<span id="297">297</span>
<span id="298">298</span>
<span id="299">299</span>
<span id="300">300</span>
<span id="301">301</span>
<span id="302">302</span>
<span id="303">303</span>
<span id="304">304</span>
<span id="305">305</span>
<span id="306">306</span>
<span id="307">307</span>
<span id="308">308</span>
<span id="309">309</span>
<span id="310">310</span>
<span id="311">311</span>
<span id="312">312</span>
<span id="313">313</span>
<span id="314">314</span>
<span id="315">315</span>
<span id="316">316</span>
<span id="317">317</span>
<span id="318">318</span>
<span id="319">319</span>
<span id="320">320</span>
<span id="321">321</span>
<span id="322">322</span>
<span id="323">323</span>
<span id="324">324</span>
<span id="325">325</span>
<span id="326">326</span>
<span id="327">327</span>
<span id="328">328</span>
<span id="329">329</span>
<span id="330">330</span>
<span id="331">331</span>
<span id="332">332</span>
<span id="333">333</span>
<span id="334">334</span>
<span id="335">335</span>
<span id="336">336</span>
<span id="337">337</span>
<span id="338">338</span>
<span id="339">339</span>
<span id="340">340</span>
<span id="341">341</span>
<span id="342">342</span>
<span id="343">343</span>
<span id="344">344</span>
<span id="345">345</span>
<span id="346">346</span>
<span id="347">347</span>
<span id="348">348</span>
<span id="349">349</span>
<span id="350">350</span>
<span id="351">351</span>
<span id="352">352</span>
<span id="353">353</span>
<span id="354">354</span>
<span id="355">355</span>
<span id="356">356</span>
<span id="357">357</span>
<span id="358">358</span>
<span id="359">359</span>
<span id="360">360</span>
<span id="361">361</span>
<span id="362">362</span>
<span id="363">363</span>
<span id="364">364</span>
<span id="365">365</span>
<span id="366">366</span>
<span id="367">367</span>
<span id="368">368</span>
<span id="369">369</span>
<span id="370">370</span>
<span id="371">371</span>
<span id="372">372</span>
<span id="373">373</span>
<span id="374">374</span>
<span id="375">375</span>
<span id="376">376</span>
<span id="377">377</span>
<span id="378">378</span>
<span id="379">379</span>
<span id="380">380</span>
<span id="381">381</span>
<span id="382">382</span>
<span id="383">383</span>
<span id="384">384</span>
<span id="385">385</span>
<span id="386">386</span>
<span id="387">387</span>
<span id="388">388</span>
<span id="389">389</span>
<span id="390">390</span>
<span id="391">391</span>
<span id="392">392</span>
<span id="393">393</span>
<span id="394">394</span>
<span id="395">395</span>
<span id="396">396</span>
<span id="397">397</span>
<span id="398">398</span>
<span id="399">399</span>
<span id="400">400</span>
<span id="401">401</span>
<span id="402">402</span>
<span id="403">403</span>
<span id="404">404</span>
<span id="405">405</span>
<span id="406">406</span>
<span id="407">407</span>
<span id="408">408</span>
<span id="409">409</span>
<span id="410">410</span>
<span id="411">411</span>
<span id="412">412</span>
<span id="413">413</span>
<span id="414">414</span>
<span id="415">415</span>
<span id="416">416</span>
<span id="417">417</span>
<span id="418">418</span>
<span id="419">419</span>
<span id="420">420</span>
<span id="421">421</span>
<span id="422">422</span>
<span id="423">423</span>
<span id="424">424</span>
<span id="425">425</span>
<span id="426">426</span>
<span id="427">427</span>
<span id="428">428</span>
<span id="429">429</span>
<span id="430">430</span>
<span id="431">431</span>
<span id="432">432</span>
<span id="433">433</span>
<span id="434">434</span>
<span id="435">435</span>
<span id="436">436</span>
<span id="437">437</span>
<span id="438">438</span>
<span id="439">439</span>
<span id="440">440</span>
<span id="441">441</span>
<span id="442">442</span>
<span id="443">443</span>
<span id="444">444</span>
<span id="445">445</span>
<span id="446">446</span>
<span id="447">447</span>
<span id="448">448</span>
<span id="449">449</span>
<span id="450">450</span>
<span id="451">451</span>
<span id="452">452</span>
<span id="453">453</span>
<span id="454">454</span>
<span id="455">455</span>
<span id="456">456</span>
<span id="457">457</span>
<span id="458">458</span>
<span id="459">459</span>
<span id="460">460</span>
<span id="461">461</span>
<span id="462">462</span>
<span id="463">463</span>
<span id="464">464</span>
<span id="465">465</span>
<span id="466">466</span>
<span id="467">467</span>
<span id="468">468</span>
<span id="469">469</span>
<span id="470">470</span>
<span id="471">471</span>
<span id="472">472</span>
<span id="473">473</span>
<span id="474">474</span>
<span id="475">475</span>
<span id="476">476</span>
<span id="477">477</span>
<span id="478">478</span>
<span id="479">479</span>
<span id="480">480</span>
<span id="481">481</span>
<span id="482">482</span>
<span id="483">483</span>
<span id="484">484</span>
<span id="485">485</span>
<span id="486">486</span>
<span id="487">487</span>
<span id="488">488</span>
<span id="489">489</span>
<span id="490">490</span>
<span id="491">491</span>
<span id="492">492</span>
<span id="493">493</span>
<span id="494">494</span>
<span id="495">495</span>
<span id="496">496</span>
<span id="497">497</span>
<span id="498">498</span>
<span id="499">499</span>
<span id="500">500</span>
<span id="501">501</span>
<span id="502">502</span>
<span id="503">503</span>
<span id="504">504</span>
<span id="505">505</span>
<span id="506">506</span>
<span id="507">507</span>
<span id="508">508</span>
<span id="509">509</span>
<span id="510">510</span>
<span id="511">511</span>
<span id="512">512</span>
<span id="513">513</span>
<span id="514">514</span>
<span id="515">515</span>
<span id="516">516</span>
<span id="517">517</span>
<span id="518">518</span>
<span id="519">519</span>
<span id="520">520</span>
<span id="521">521</span>
<span id="522">522</span>
<span id="523">523</span>
<span id="524">524</span>
<span id="525">525</span>
<span id="526">526</span>
<span id="527">527</span>
<span id="528">528</span>
<span id="529">529</span>
<span id="530">530</span>
<span id="531">531</span>
<span id="532">532</span>
<span id="533">533</span>
<span id="534">534</span>
<span id="535">535</span>
<span id="536">536</span>
<span id="537">537</span>
<span id="538">538</span>
<span id="539">539</span>
<span id="540">540</span>
<span id="541">541</span>
<span id="542">542</span>
<span id="543">543</span>
<span id="544">544</span>
<span id="545">545</span>
<span id="546">546</span>
<span id="547">547</span>
<span id="548">548</span>
<span id="549">549</span>
<span id="550">550</span>
<span id="551">551</span>
<span id="552">552</span>
<span id="553">553</span>
<span id="554">554</span>
<span id="555">555</span>
<span id="556">556</span>
<span id="557">557</span>
<span id="558">558</span>
<span id="559">559</span>
<span id="560">560</span>
<span id="561">561</span>
<span id="562">562</span>
<span id="563">563</span>
<span id="564">564</span>
<span id="565">565</span>
<span id="566">566</span>
<span id="567">567</span>
<span id="568">568</span>
<span id="569">569</span>
<span id="570">570</span>
<span id="571">571</span>
<span id="572">572</span>
<span id="573">573</span>
<span id="574">574</span>
<span id="575">575</span>
<span id="576">576</span>
<span id="577">577</span>
<span id="578">578</span>
<span id="579">579</span>
<span id="580">580</span>
<span id="581">581</span>
<span id="582">582</span>
<span id="583">583</span>
<span id="584">584</span>
<span id="585">585</span>
<span id="586">586</span>
<span id="587">587</span>
<span id="588">588</span>
<span id="589">589</span>
<span id="590">590</span>
<span id="591">591</span>
<span id="592">592</span>
<span id="593">593</span>
<span id="594">594</span>
<span id="595">595</span>
<span id="596">596</span>
<span id="597">597</span>
<span id="598">598</span>
<span id="599">599</span>
<span id="600">600</span>
<span id="601">601</span>
<span id="602">602</span>
<span id="603">603</span>
<span id="604">604</span>
<span id="605">605</span>
<span id="606">606</span>
<span id="607">607</span>
<span id="608">608</span>
<span id="609">609</span>
<span id="610">610</span>
<span id="611">611</span>
<span id="612">612</span>
<span id="613">613</span>
<span id="614">614</span>
<span id="615">615</span>
<span id="616">616</span>
<span id="617">617</span>
<span id="618">618</span>
<span id="619">619</span>
<span id="620">620</span>
<span id="621">621</span>
<span id="622">622</span>
<span id="623">623</span>
<span id="624">624</span>
<span id="625">625</span>
<span id="626">626</span>
<span id="627">627</span>
<span id="628">628</span>
<span id="629">629</span>
<span id="630">630</span>
<span id="631">631</span>
<span id="632">632</span>
<span id="633">633</span>
<span id="634">634</span>
<span id="635">635</span>
<span id="636">636</span>
<span id="637">637</span>
<span id="638">638</span>
<span id="639">639</span>
<span id="640">640</span>
<span id="641">641</span>
<span id="642">642</span>
<span id="643">643</span>
<span id="644">644</span>
<span id="645">645</span>
<span id="646">646</span>
<span id="647">647</span>
<span id="648">648</span>
<span id="649">649</span>
<span id="650">650</span>
<span id="651">651</span>
<span id="652">652</span>
<span id="653">653</span>
<span id="654">654</span>
<span id="655">655</span>
<span id="656">656</span>
<span id="657">657</span>
<span id="658">658</span>
<span id="659">659</span>
<span id="660">660</span>
<span id="661">661</span>
<span id="662">662</span>
<span id="663">663</span>
<span id="664">664</span>
<span id="665">665</span>
<span id="666">666</span>
<span id="667">667</span>
<span id="668">668</span>
<span id="669">669</span>
<span id="670">670</span>
<span id="671">671</span>
<span id="672">672</span>
<span id="673">673</span>
<span id="674">674</span>
<span id="675">675</span>
<span id="676">676</span>
<span id="677">677</span>
<span id="678">678</span>
<span id="679">679</span>
<span id="680">680</span>
<span id="681">681</span>
<span id="682">682</span>
<span id="683">683</span>
<span id="684">684</span>
<span id="685">685</span>
<span id="686">686</span>
<span id="687">687</span>
<span id="688">688</span>
<span id="689">689</span>
<span id="690">690</span>
<span id="691">691</span>
<span id="692">692</span>
<span id="693">693</span>
<span id="694">694</span>
<span id="695">695</span>
<span id="696">696</span>
<span id="697">697</span>
<span id="698">698</span>
<span id="699">699</span>
<span id="700">700</span>
<span id="701">701</span>
<span id="702">702</span>
<span id="703">703</span>
<span id="704">704</span>
<span id="705">705</span>
<span id="706">706</span>
<span id="707">707</span>
<span id="708">708</span>
<span id="709">709</span>
<span id="710">710</span>
<span id="711">711</span>
<span id="712">712</span>
<span id="713">713</span>
<span id="714">714</span>
<span id="715">715</span>
<span id="716">716</span>
<span id="717">717</span>
<span id="718">718</span>
<span id="719">719</span>
<span id="720">720</span>
<span id="721">721</span>
<span id="722">722</span>
<span id="723">723</span>
<span id="724">724</span>
<span id="725">725</span>
<span id="726">726</span>
<span id="727">727</span>
<span id="728">728</span>
<span id="729">729</span>
<span id="730">730</span>
<span id="731">731</span>
<span id="732">732</span>
<span id="733">733</span>
<span id="734">734</span>
<span id="735">735</span>
<span id="736">736</span>
<span id="737">737</span>
<span id="738">738</span>
<span id="739">739</span>
<span id="740">740</span>
<span id="741">741</span>
<span id="742">742</span>
<span id="743">743</span>
<span id="744">744</span>
<span id="745">745</span>
<span id="746">746</span>
<span id="747">747</span>
<span id="748">748</span>
<span id="749">749</span>
<span id="750">750</span>
<span id="751">751</span>
<span id="752">752</span>
<span id="753">753</span>
<span id="754">754</span>
<span id="755">755</span>
<span id="756">756</span>
<span id="757">757</span>
<span id="758">758</span>
<span id="759">759</span>
<span id="760">760</span>
<span id="761">761</span>
<span id="762">762</span>
<span id="763">763</span>
<span id="764">764</span>
<span id="765">765</span>
<span id="766">766</span>
<span id="767">767</span>
<span id="768">768</span>
<span id="769">769</span>
<span id="770">770</span>
<span id="771">771</span>
<span id="772">772</span>
<span id="773">773</span>
<span id="774">774</span>
<span id="775">775</span>
<span id="776">776</span>
<span id="777">777</span>
<span id="778">778</span>
<span id="779">779</span>
<span id="780">780</span>
<span id="781">781</span>
<span id="782">782</span>
<span id="783">783</span>
<span id="784">784</span>
<span id="785">785</span>
<span id="786">786</span>
<span id="787">787</span>
<span id="788">788</span>
<span id="789">789</span>
<span id="790">790</span>
<span id="791">791</span>
<span id="792">792</span>
<span id="793">793</span>
<span id="794">794</span>
<span id="795">795</span>
<span id="796">796</span>
<span id="797">797</span>
<span id="798">798</span>
<span id="799">799</span>
<span id="800">800</span>
<span id="801">801</span>
<span id="802">802</span>
<span id="803">803</span>
<span id="804">804</span>
<span id="805">805</span>
<span id="806">806</span>
<span id="807">807</span>
<span id="808">808</span>
<span id="809">809</span>
<span id="810">810</span>
<span id="811">811</span>
<span id="812">812</span>
<span id="813">813</span>
<span id="814">814</span>
<span id="815">815</span>
<span id="816">816</span>
<span id="817">817</span>
<span id="818">818</span>
<span id="819">819</span>
<span id="820">820</span>
<span id="821">821</span>
<span id="822">822</span>
<span id="823">823</span>
<span id="824">824</span>
<span id="825">825</span>
<span id="826">826</span>
<span id="827">827</span>
<span id="828">828</span>
<span id="829">829</span>
<span id="830">830</span>
<span id="831">831</span>
<span id="832">832</span>
<span id="833">833</span>
<span id="834">834</span>
<span id="835">835</span>
<span id="836">836</span>
<span id="837">837</span>
<span id="838">838</span>
<span id="839">839</span>
<span id="840">840</span>
<span id="841">841</span>
<span id="842">842</span>
<span id="843">843</span>
<span id="844">844</span>
<span id="845">845</span>
<span id="846">846</span>
<span id="847">847</span>
<span id="848">848</span>
<span id="849">849</span>
<span id="850">850</span>
<span id="851">851</span>
<span id="852">852</span>
<span id="853">853</span>
<span id="854">854</span>
<span id="855">855</span>
<span id="856">856</span>
<span id="857">857</span>
<span id="858">858</span>
<span id="859">859</span>
<span id="860">860</span>
<span id="861">861</span>
<span id="862">862</span>
<span id="863">863</span>
<span id="864">864</span>
<span id="865">865</span>
<span id="866">866</span>
<span id="867">867</span>
<span id="868">868</span>
<span id="869">869</span>
<span id="870">870</span>
<span id="871">871</span>
<span id="872">872</span>
<span id="873">873</span>
<span id="874">874</span>
<span id="875">875</span>
<span id="876">876</span>
<span id="877">877</span>
<span id="878">878</span>
<span id="879">879</span>
<span id="880">880</span>
<span id="881">881</span>
<span id="882">882</span>
<span id="883">883</span>
<span id="884">884</span>
<span id="885">885</span>
<span id="886">886</span>
<span id="887">887</span>
<span id="888">888</span>
<span id="889">889</span>
<span id="890">890</span>
<span id="891">891</span>
<span id="892">892</span>
<span id="893">893</span>
<span id="894">894</span>
<span id="895">895</span>
<span id="896">896</span>
<span id="897">897</span>
<span id="898">898</span>
<span id="899">899</span>
<span id="900">900</span>
<span id="901">901</span>
<span id="902">902</span>
<span id="903">903</span>
<span id="904">904</span>
<span id="905">905</span>
<span id="906">906</span>
<span id="907">907</span>
<span id="908">908</span>
<span id="909">909</span>
<span id="910">910</span>
<span id="911">911</span>
<span id="912">912</span>
<span id="913">913</span>
<span id="914">914</span>
<span id="915">915</span>
<span id="916">916</span>
<span id="917">917</span>
<span id="918">918</span>
<span id="919">919</span>
<span id="920">920</span>
<span id="921">921</span>
<span id="922">922</span>
<span id="923">923</span>
<span id="924">924</span>
<span id="925">925</span>
<span id="926">926</span>
<span id="927">927</span>
<span id="928">928</span>
<span id="929">929</span>
<span id="930">930</span>
<span id="931">931</span>
<span id="932">932</span>
<span id="933">933</span>
<span id="934">934</span>
<span id="935">935</span>
<span id="936">936</span>
<span id="937">937</span>
<span id="938">938</span>
<span id="939">939</span>
<span id="940">940</span>
<span id="941">941</span>
<span id="942">942</span>
<span id="943">943</span>
<span id="944">944</span>
<span id="945">945</span>
<span id="946">946</span>
<span id="947">947</span>
<span id="948">948</span>
<span id="949">949</span>
<span id="950">950</span>
<span id="951">951</span>
<span id="952">952</span>
<span id="953">953</span>
<span id="954">954</span>
<span id="955">955</span>
<span id="956">956</span>
<span id="957">957</span>
<span id="958">958</span>
<span id="959">959</span>
<span id="960">960</span>
<span id="961">961</span>
<span id="962">962</span>
<span id="963">963</span>
<span id="964">964</span>
<span id="965">965</span>
<span id="966">966</span>
<span id="967">967</span>
<span id="968">968</span>
<span id="969">969</span>
<span id="970">970</span>
<span id="971">971</span>
<span id="972">972</span>
<span id="973">973</span>
<span id="974">974</span>
<span id="975">975</span>
<span id="976">976</span>
<span id="977">977</span>
<span id="978">978</span>
<span id="979">979</span>
<span id="980">980</span>
<span id="981">981</span>
<span id="982">982</span>
<span id="983">983</span>
<span id="984">984</span>
<span id="985">985</span>
<span id="986">986</span>
<span id="987">987</span>
<span id="988">988</span>
<span id="989">989</span>
<span id="990">990</span>
<span id="991">991</span>
<span id="992">992</span>
<span id="993">993</span>
<span id="994">994</span>
<span id="995">995</span>
<span id="996">996</span>
<span id="997">997</span>
<span id="998">998</span>
<span id="999">999</span>
<span id="1000">1000</span>
<span id="1001">1001</span>
<span id="1002">1002</span>
<span id="1003">1003</span>
<span id="1004">1004</span>
<span id="1005">1005</span>
<span id="1006">1006</span>
<span id="1007">1007</span>
<span id="1008">1008</span>
<span id="1009">1009</span>
<span id="1010">1010</span>
<span id="1011">1011</span>
<span id="1012">1012</span>
<span id="1013">1013</span>
<span id="1014">1014</span>
<span id="1015">1015</span>
<span id="1016">1016</span>
<span id="1017">1017</span>
<span id="1018">1018</span>
<span id="1019">1019</span>
<span id="1020">1020</span>
<span id="1021">1021</span>
<span id="1022">1022</span>
<span id="1023">1023</span>
<span id="1024">1024</span>
<span id="1025">1025</span>
<span id="1026">1026</span>
<span id="1027">1027</span>
<span id="1028">1028</span>
<span id="1029">1029</span>
<span id="1030">1030</span>
<span id="1031">1031</span>
<span id="1032">1032</span>
<span id="1033">1033</span>
<span id="1034">1034</span>
<span id="1035">1035</span>
<span id="1036">1036</span>
<span id="1037">1037</span>
<span id="1038">1038</span>
<span id="1039">1039</span>
<span id="1040">1040</span>
<span id="1041">1041</span>
<span id="1042">1042</span>
<span id="1043">1043</span>
<span id="1044">1044</span>
<span id="1045">1045</span>
<span id="1046">1046</span>
<span id="1047">1047</span>
<span id="1048">1048</span>
<span id="1049">1049</span>
<span id="1050">1050</span>
<span id="1051">1051</span>
<span id="1052">1052</span>
<span id="1053">1053</span>
<span id="1054">1054</span>
<span id="1055">1055</span>
<span id="1056">1056</span>
<span id="1057">1057</span>
<span id="1058">1058</span>
<span id="1059">1059</span>
<span id="1060">1060</span>
<span id="1061">1061</span>
<span id="1062">1062</span>
<span id="1063">1063</span>
<span id="1064">1064</span>
<span id="1065">1065</span>
<span id="1066">1066</span>
<span id="1067">1067</span>
<span id="1068">1068</span>
</pre><pre class="rust"><code><span class="comment">// Copyright 2018 foundationdb-rs developers, https://github.com/Clikengo/foundationdb-rs/graphs/contributors
// Copyright 2013-2018 Apple, Inc and the FoundationDB project authors.
//
// Licensed under the Apache License, Version 2.0, &lt;LICENSE-APACHE or
// http://apache.org/licenses/LICENSE-2.0&gt; or the MIT license &lt;LICENSE-MIT or
// http://opensource.org/licenses/MIT&gt;, at your option. This file may not be
// copied, modified, or distributed except according to those terms.

</span><span class="doccomment">//! Implementations of the FDBTransaction C API
//!
//! &lt;https://apple.github.io/foundationdb/api-c.html#transaction&gt;

</span><span class="kw">use </span>foundationdb_sys <span class="kw">as </span>fdb_sys;
<span class="kw">use </span>std::fmt;
<span class="kw">use </span>std::ops::{Deref, Range, RangeInclusive};
<span class="kw">use </span>std::ptr::NonNull;
<span class="kw">use </span>std::sync::Arc;

<span class="kw">use </span><span class="kw">crate</span>::future::<span class="kw-2">*</span>;
<span class="kw">use </span><span class="kw">crate</span>::keyselector::<span class="kw-2">*</span>;
<span class="kw">use </span><span class="kw">crate</span>::options;

<span class="kw">use crate</span>::{error, FdbError, FdbResult};
<span class="kw">use </span>foundationdb_macros::cfg_api_versions;

<span class="kw">use </span><span class="kw">crate</span>::error::FdbBindingError;

<span class="kw">use </span>futures::{
    future, future::Either, stream, Future, FutureExt, Stream, TryFutureExt, TryStreamExt,
};

<span class="attribute">#[cfg_api_versions(min = <span class="number">610</span>)]
</span><span class="kw">const </span>METADATA_VERSION_KEY: <span class="kw-2">&amp;</span>[u8] = <span class="string">b&quot;\xff/metadataVersion&quot;</span>;

<span class="doccomment">/// A committed transaction.
</span><span class="attribute">#[derive(Debug)]
#[repr(transparent)]
</span><span class="kw">pub struct </span>TransactionCommitted {
    tr: Transaction,
}

<span class="kw">impl </span>TransactionCommitted {
    <span class="doccomment">/// Retrieves the database version number at which a given transaction was committed.
    ///
    /// Read-only transactions do not modify the database when committed and will have a committed
    /// version of -1. Keep in mind that a transaction which reads keys and then sets them to their
    /// current values may be optimized to a read-only transaction.
    ///
    /// Note that database versions are not necessarily unique to a given transaction and so cannot
    /// be used to determine in what order two transactions completed. The only use for this
    /// function is to manually enforce causal consistency when calling `set_read_version()` on
    /// another subsequent transaction.
    ///
    /// Most applications will not call this function.
    </span><span class="kw">pub fn </span>committed_version(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; FdbResult&lt;i64&gt; {
        <span class="kw">let </span><span class="kw-2">mut </span>version: i64 = <span class="number">0</span>;
        error::eval(<span class="kw">unsafe </span>{
            fdb_sys::fdb_transaction_get_committed_version(<span class="self">self</span>.tr.inner.as_ptr(), <span class="kw-2">&amp;mut </span>version)
        })<span class="question-mark">?</span>;
        <span class="prelude-val">Ok</span>(version)
    }

    <span class="doccomment">/// Reset the transaction to its initial state.
    ///
    /// This will not affect previously committed data.
    ///
    /// This is similar to dropping the transaction and creating a new one.
    </span><span class="kw">pub fn </span>reset(<span class="kw-2">mut </span><span class="self">self</span>) -&gt; Transaction {
        <span class="self">self</span>.tr.reset();
        <span class="self">self</span>.tr
    }
}
<span class="kw">impl </span>From&lt;TransactionCommitted&gt; <span class="kw">for </span>Transaction {
    <span class="kw">fn </span>from(tc: TransactionCommitted) -&gt; Transaction {
        tc.reset()
    }
}

<span class="doccomment">/// A failed to commit transaction.
</span><span class="kw">pub struct </span>TransactionCommitError {
    tr: Transaction,
    err: FdbError,
}

<span class="kw">impl </span>TransactionCommitError {
    <span class="doccomment">/// Implements the recommended retry and backoff behavior for a transaction. This function knows
    /// which of the error codes generated by other `Transaction` functions represent temporary
    /// error conditions and which represent application errors that should be handled by the
    /// application. It also implements an exponential backoff strategy to avoid swamping the
    /// database cluster with excessive retries when there is a high level of conflict between
    /// transactions.
    ///
    /// You should not call this method most of the times and use `Database::transact` which
    /// implements a retry loop strategy for you.
    </span><span class="kw">pub fn </span>on_error(<span class="self">self</span>) -&gt; <span class="kw">impl </span>Future&lt;Output = FdbResult&lt;Transaction&gt;&gt; {
        FdbFuture::&lt;()&gt;::new(<span class="kw">unsafe </span>{
            fdb_sys::fdb_transaction_on_error(<span class="self">self</span>.tr.inner.as_ptr(), <span class="self">self</span>.err.code())
        })
        .map_ok(|()| <span class="self">self</span>.tr)
    }

    <span class="doccomment">/// Reset the transaction to its initial state.
    ///
    /// This is similar to dropping the transaction and creating a new one.
    </span><span class="kw">pub fn </span>reset(<span class="kw-2">mut </span><span class="self">self</span>) -&gt; Transaction {
        <span class="self">self</span>.tr.reset();
        <span class="self">self</span>.tr
    }
}

<span class="kw">impl </span>Deref <span class="kw">for </span>TransactionCommitError {
    <span class="kw">type </span>Target = FdbError;
    <span class="kw">fn </span>deref(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; <span class="kw-2">&amp;</span>FdbError {
        <span class="kw-2">&amp;</span><span class="self">self</span>.err
    }
}

<span class="kw">impl </span>From&lt;TransactionCommitError&gt; <span class="kw">for </span>FdbError {
    <span class="kw">fn </span>from(tce: TransactionCommitError) -&gt; FdbError {
        tce.err
    }
}

<span class="kw">impl </span>fmt::Debug <span class="kw">for </span>TransactionCommitError {
    <span class="kw">fn </span>fmt(<span class="kw-2">&amp;</span><span class="self">self</span>, f: <span class="kw-2">&amp;mut </span>fmt::Formatter) -&gt; fmt::Result {
        <span class="macro">write!</span>(f, <span class="string">&quot;TransactionCommitError({})&quot;</span>, <span class="self">self</span>.err)
    }
}

<span class="kw">impl </span>fmt::Display <span class="kw">for </span>TransactionCommitError {
    <span class="kw">fn </span>fmt(<span class="kw-2">&amp;</span><span class="self">self</span>, f: <span class="kw-2">&amp;mut </span>fmt::Formatter) -&gt; fmt::Result {
        <span class="self">self</span>.err.fmt(f)
    }
}

<span class="doccomment">/// The result of `Transaction::Commit`
</span><span class="kw">type </span>TransactionResult = <span class="prelude-ty">Result</span>&lt;TransactionCommitted, TransactionCommitError&gt;;

<span class="doccomment">/// A cancelled transaction
</span><span class="attribute">#[derive(Debug)]
#[repr(transparent)]
</span><span class="kw">pub struct </span>TransactionCancelled {
    tr: Transaction,
}
<span class="kw">impl </span>TransactionCancelled {
    <span class="doccomment">/// Reset the transaction to its initial state.
    ///
    /// This is similar to dropping the transaction and creating a new one.
    </span><span class="kw">pub fn </span>reset(<span class="kw-2">mut </span><span class="self">self</span>) -&gt; Transaction {
        <span class="self">self</span>.tr.reset();
        <span class="self">self</span>.tr
    }
}
<span class="kw">impl </span>From&lt;TransactionCancelled&gt; <span class="kw">for </span>Transaction {
    <span class="kw">fn </span>from(tc: TransactionCancelled) -&gt; Transaction {
        tc.reset()
    }
}

<span class="doccomment">/// In FoundationDB, a transaction is a mutable snapshot of a database.
///
/// All read and write operations on a transaction see and modify an otherwise-unchanging version of the database and only change the underlying database if and when the transaction is committed. Read operations do see the effects of previous write operations on the same transaction. Committing a transaction usually succeeds in the absence of conflicts.
///
/// Applications must provide error handling and an appropriate retry loop around the application code for a transaction. See the documentation for [fdb_transaction_on_error()](https://apple.github.io/foundationdb/api-c.html#transaction).
///
/// Transactions group operations into a unit with the properties of atomicity, isolation, and durability. Transactions also provide the ability to maintain an application’s invariants or integrity constraints, supporting the property of consistency. Together these properties are known as ACID.
///
/// Transactions are also causally consistent: once a transaction has been successfully committed, all subsequently created transactions will see the modifications made by it.
</span><span class="attribute">#[derive(Debug)]
</span><span class="kw">pub struct </span>Transaction {
    <span class="comment">// Order of fields should not be changed, because Rust drops field top-to-bottom, and
    // transaction should be dropped before cluster.
    </span>inner: NonNull&lt;fdb_sys::FDBTransaction&gt;,
}
<span class="kw">unsafe impl </span>Send <span class="kw">for </span>Transaction {}
<span class="kw">unsafe impl </span>Sync <span class="kw">for </span>Transaction {}

<span class="doccomment">/// Converts Rust `bool` into `fdb_sys::fdb_bool_t`
</span><span class="attribute">#[inline]
</span><span class="kw">fn </span>fdb_bool(v: bool) -&gt; fdb_sys::fdb_bool_t {
    <span class="kw">if </span>v {
        <span class="number">1
    </span>} <span class="kw">else </span>{
        <span class="number">0
    </span>}
}
<span class="attribute">#[inline]
</span><span class="kw">fn </span>fdb_len(len: usize, context: <span class="kw-2">&amp;</span><span class="lifetime">&#39;static </span>str) -&gt; std::os::raw::c_int {
    <span class="macro">assert!</span>(
        len &lt;= i32::max_value() <span class="kw">as </span>usize,
        <span class="string">&quot;{}.len() &gt; i32::max_value()&quot;</span>,
        context
    );
    len <span class="kw">as </span>i32
}
<span class="attribute">#[inline]
</span><span class="kw">fn </span>fdb_iteration(iteration: usize) -&gt; std::os::raw::c_int {
    <span class="kw">if </span>iteration &gt; i32::max_value() <span class="kw">as </span>usize {
        <span class="number">0 </span><span class="comment">// this will cause client_invalid_operation
    </span>} <span class="kw">else </span>{
        iteration <span class="kw">as </span>i32
    }
}
<span class="attribute">#[inline]
</span><span class="kw">fn </span>fdb_limit(v: usize) -&gt; std::os::raw::c_int {
    <span class="kw">if </span>v &gt; i32::max_value() <span class="kw">as </span>usize {
        i32::max_value()
    } <span class="kw">else </span>{
        v <span class="kw">as </span>i32
    }
}

<span class="doccomment">/// `RangeOption` represents a query parameters for range scan query.
///
/// You can construct `RangeOption` easily:
///
/// ```
/// use foundationdb::RangeOption;
///
/// let opt = RangeOption::from((b&quot;begin&quot;.as_ref(), b&quot;end&quot;.as_ref()));
/// let opt: RangeOption = (b&quot;begin&quot;.as_ref()..b&quot;end&quot;.as_ref()).into();
/// let opt = RangeOption {
///     limit: Some(10),
///     ..RangeOption::from((b&quot;begin&quot;.as_ref(), b&quot;end&quot;.as_ref()))
/// };
/// ```
</span><span class="attribute">#[derive(Debug, Clone)]
</span><span class="kw">pub struct </span>RangeOption&lt;<span class="lifetime">&#39;a</span>&gt; {
    <span class="doccomment">/// The beginning of the range.
    </span><span class="kw">pub </span>begin: KeySelector&lt;<span class="lifetime">&#39;a</span>&gt;,
    <span class="doccomment">/// The end of the range.
    </span><span class="kw">pub </span>end: KeySelector&lt;<span class="lifetime">&#39;a</span>&gt;,
    <span class="doccomment">/// If non-zero, indicates the maximum number of key-value pairs to return.
    </span><span class="kw">pub </span>limit: <span class="prelude-ty">Option</span>&lt;usize&gt;,
    <span class="doccomment">/// If non-zero, indicates a (soft) cap on the combined number of bytes of keys and values to
    /// return for each item.
    </span><span class="kw">pub </span>target_bytes: usize,
    <span class="doccomment">/// One of the options::StreamingMode values indicating how the caller would like the data in
    /// the range returned.
    </span><span class="kw">pub </span>mode: options::StreamingMode,
    <span class="doccomment">/// If true, key-value pairs will be returned in reverse lexicographical order beginning at
    /// the end of the range.
    </span><span class="kw">pub </span>reverse: bool,
    <span class="attribute">#[doc(hidden)]
    </span><span class="kw">pub </span>__non_exhaustive: std::marker::PhantomData&lt;()&gt;,
}

<span class="kw">impl</span>&lt;<span class="lifetime">&#39;a</span>&gt; RangeOption&lt;<span class="lifetime">&#39;a</span>&gt; {
    <span class="doccomment">/// Reverses the range direction.
    </span><span class="kw">pub fn </span>rev(<span class="kw-2">mut </span><span class="self">self</span>) -&gt; <span class="self">Self </span>{
        <span class="self">self</span>.reverse = !<span class="self">self</span>.reverse;
        <span class="self">self
    </span>}

    <span class="kw">pub fn </span>next_range(<span class="kw-2">mut </span><span class="self">self</span>, kvs: <span class="kw-2">&amp;</span>FdbValues) -&gt; <span class="prelude-ty">Option</span>&lt;<span class="self">Self</span>&gt; {
        <span class="kw">if </span>!kvs.more() {
            <span class="kw">return </span><span class="prelude-val">None</span>;
        }

        <span class="kw">let </span>last = kvs.last()<span class="question-mark">?</span>;
        <span class="kw">let </span>last_key = last.key();

        <span class="kw">if let </span><span class="prelude-val">Some</span>(limit) = <span class="self">self</span>.limit.as_mut() {
            <span class="kw-2">*</span>limit = limit.saturating_sub(kvs.len());
            <span class="kw">if </span><span class="kw-2">*</span>limit == <span class="number">0 </span>{
                <span class="kw">return </span><span class="prelude-val">None</span>;
            }
        }

        <span class="kw">if </span><span class="self">self</span>.reverse {
            <span class="self">self</span>.end.make_first_greater_or_equal(last_key);
        } <span class="kw">else </span>{
            <span class="self">self</span>.begin.make_first_greater_than(last_key);
        }
        <span class="prelude-val">Some</span>(<span class="self">self</span>)
    }

    <span class="attribute">#[cfg_api_versions(min = <span class="number">710</span>)]
    </span><span class="kw">pub</span>(<span class="kw">crate</span>) <span class="kw">fn </span>next_mapped_range(<span class="kw-2">mut </span><span class="self">self</span>, kvs: <span class="kw-2">&amp;</span>MappedKeyValues) -&gt; <span class="prelude-ty">Option</span>&lt;<span class="self">Self</span>&gt; {
        <span class="kw">if </span>!kvs.more() {
            <span class="kw">return </span><span class="prelude-val">None</span>;
        }

        <span class="kw">let </span>last = kvs.last()<span class="question-mark">?</span>;
        <span class="kw">let </span>last_key = last.parent_key();

        <span class="kw">if let </span><span class="prelude-val">Some</span>(limit) = <span class="self">self</span>.limit.as_mut() {
            <span class="kw-2">*</span>limit = limit.saturating_sub(kvs.len());
            <span class="kw">if </span><span class="kw-2">*</span>limit == <span class="number">0 </span>{
                <span class="kw">return </span><span class="prelude-val">None</span>;
            }
        }

        <span class="kw">if </span><span class="self">self</span>.reverse {
            <span class="self">self</span>.end.make_first_greater_or_equal(last_key);
        } <span class="kw">else </span>{
            <span class="self">self</span>.begin.make_first_greater_than(last_key);
        }
        <span class="prelude-val">Some</span>(<span class="self">self</span>)
    }
}

<span class="kw">impl</span>&lt;<span class="lifetime">&#39;a</span>&gt; Default <span class="kw">for </span>RangeOption&lt;<span class="lifetime">&#39;a</span>&gt; {
    <span class="kw">fn </span>default() -&gt; <span class="self">Self </span>{
        <span class="self">Self </span>{
            begin: KeySelector::first_greater_or_equal([].as_ref()),
            end: KeySelector::first_greater_or_equal([].as_ref()),
            limit: <span class="prelude-val">None</span>,
            target_bytes: <span class="number">0</span>,
            mode: options::StreamingMode::Iterator,
            reverse: <span class="bool-val">false</span>,
            __non_exhaustive: std::marker::PhantomData,
        }
    }
}

<span class="kw">impl</span>&lt;<span class="lifetime">&#39;a</span>&gt; From&lt;(KeySelector&lt;<span class="lifetime">&#39;a</span>&gt;, KeySelector&lt;<span class="lifetime">&#39;a</span>&gt;)&gt; <span class="kw">for </span>RangeOption&lt;<span class="lifetime">&#39;a</span>&gt; {
    <span class="kw">fn </span>from((begin, end): (KeySelector&lt;<span class="lifetime">&#39;a</span>&gt;, KeySelector&lt;<span class="lifetime">&#39;a</span>&gt;)) -&gt; <span class="self">Self </span>{
        <span class="self">Self </span>{
            begin,
            end,
            ..<span class="self">Self</span>::default()
        }
    }
}
<span class="kw">impl </span>From&lt;(Vec&lt;u8&gt;, Vec&lt;u8&gt;)&gt; <span class="kw">for </span>RangeOption&lt;<span class="lifetime">&#39;static</span>&gt; {
    <span class="kw">fn </span>from((begin, end): (Vec&lt;u8&gt;, Vec&lt;u8&gt;)) -&gt; <span class="self">Self </span>{
        <span class="self">Self </span>{
            begin: KeySelector::first_greater_or_equal(begin),
            end: KeySelector::first_greater_or_equal(end),
            ..<span class="self">Self</span>::default()
        }
    }
}
<span class="kw">impl</span>&lt;<span class="lifetime">&#39;a</span>&gt; From&lt;(<span class="kw-2">&amp;</span><span class="lifetime">&#39;a </span>[u8], <span class="kw-2">&amp;</span><span class="lifetime">&#39;a </span>[u8])&gt; <span class="kw">for </span>RangeOption&lt;<span class="lifetime">&#39;a</span>&gt; {
    <span class="kw">fn </span>from((begin, end): (<span class="kw-2">&amp;</span><span class="lifetime">&#39;a </span>[u8], <span class="kw-2">&amp;</span><span class="lifetime">&#39;a </span>[u8])) -&gt; <span class="self">Self </span>{
        <span class="self">Self </span>{
            begin: KeySelector::first_greater_or_equal(begin),
            end: KeySelector::first_greater_or_equal(end),
            ..<span class="self">Self</span>::default()
        }
    }
}
<span class="kw">impl</span>&lt;<span class="lifetime">&#39;a</span>&gt; From&lt;std::ops::Range&lt;KeySelector&lt;<span class="lifetime">&#39;a</span>&gt;&gt;&gt; <span class="kw">for </span>RangeOption&lt;<span class="lifetime">&#39;a</span>&gt; {
    <span class="kw">fn </span>from(range: Range&lt;KeySelector&lt;<span class="lifetime">&#39;a</span>&gt;&gt;) -&gt; <span class="self">Self </span>{
        RangeOption::from((range.start, range.end))
    }
}

<span class="kw">impl</span>&lt;<span class="lifetime">&#39;a</span>&gt; From&lt;std::ops::Range&lt;<span class="kw-2">&amp;</span><span class="lifetime">&#39;a </span>[u8]&gt;&gt; <span class="kw">for </span>RangeOption&lt;<span class="lifetime">&#39;a</span>&gt; {
    <span class="kw">fn </span>from(range: Range&lt;<span class="kw-2">&amp;</span><span class="lifetime">&#39;a </span>[u8]&gt;) -&gt; <span class="self">Self </span>{
        RangeOption::from((range.start, range.end))
    }
}

<span class="kw">impl </span>From&lt;std::ops::Range&lt;std::vec::Vec&lt;u8&gt;&gt;&gt; <span class="kw">for </span>RangeOption&lt;<span class="lifetime">&#39;static</span>&gt; {
    <span class="kw">fn </span>from(range: Range&lt;Vec&lt;u8&gt;&gt;) -&gt; <span class="self">Self </span>{
        RangeOption::from((range.start, range.end))
    }
}

<span class="kw">impl</span>&lt;<span class="lifetime">&#39;a</span>&gt; From&lt;std::ops::RangeInclusive&lt;<span class="kw-2">&amp;</span><span class="lifetime">&#39;a </span>[u8]&gt;&gt; <span class="kw">for </span>RangeOption&lt;<span class="lifetime">&#39;a</span>&gt; {
    <span class="kw">fn </span>from(range: RangeInclusive&lt;<span class="kw-2">&amp;</span><span class="lifetime">&#39;a </span>[u8]&gt;) -&gt; <span class="self">Self </span>{
        <span class="kw">let </span>(start, end) = range.into_inner();
        (KeySelector::first_greater_or_equal(start)..KeySelector::first_greater_than(end)).into()
    }
}

<span class="kw">impl </span>From&lt;std::ops::RangeInclusive&lt;std::vec::Vec&lt;u8&gt;&gt;&gt; <span class="kw">for </span>RangeOption&lt;<span class="lifetime">&#39;static</span>&gt; {
    <span class="kw">fn </span>from(range: RangeInclusive&lt;Vec&lt;u8&gt;&gt;) -&gt; <span class="self">Self </span>{
        <span class="kw">let </span>(start, end) = range.into_inner();
        (KeySelector::first_greater_or_equal(start)..KeySelector::first_greater_than(end)).into()
    }
}

<span class="kw">impl </span>Transaction {
    <span class="kw">pub</span>(<span class="kw">crate</span>) <span class="kw">fn </span>new(inner: NonNull&lt;fdb_sys::FDBTransaction&gt;) -&gt; <span class="self">Self </span>{
        <span class="self">Self </span>{ inner }
    }

    <span class="doccomment">/// Called to set an option on an FDBTransaction.
    </span><span class="kw">pub fn </span>set_option(<span class="kw-2">&amp;</span><span class="self">self</span>, opt: options::TransactionOption) -&gt; FdbResult&lt;()&gt; {
        <span class="kw">unsafe </span>{ opt.apply(<span class="self">self</span>.inner.as_ptr()) }
    }

    <span class="doccomment">/// Modify the database snapshot represented by transaction to change the given
    /// key to have the given value.
    ///
    /// If the given key was not previously present in the database it is inserted.
    /// The modification affects the actual database only if transaction is later
    /// committed with `Transaction::commit`.
    ///
    /// # Arguments
    ///
    /// * `key` - the name of the key to be inserted into the database.
    /// * `value` - the value to be inserted into the database
    </span><span class="kw">pub fn </span>set(<span class="kw-2">&amp;</span><span class="self">self</span>, key: <span class="kw-2">&amp;</span>[u8], value: <span class="kw-2">&amp;</span>[u8]) {
        <span class="kw">unsafe </span>{
            fdb_sys::fdb_transaction_set(
                <span class="self">self</span>.inner.as_ptr(),
                key.as_ptr(),
                fdb_len(key.len(), <span class="string">&quot;key&quot;</span>),
                value.as_ptr(),
                fdb_len(value.len(), <span class="string">&quot;value&quot;</span>),
            )
        }
    }

    <span class="doccomment">/// Modify the database snapshot represented by transaction to remove the given key from the
    /// database.
    ///
    /// If the key was not previously present in the database, there is no effect. The modification
    /// affects the actual database only if transaction is later committed with
    /// `Transaction::commit`.
    ///
    /// # Arguments
    ///
    /// * `key` - the name of the key to be removed from the database.
    </span><span class="kw">pub fn </span>clear(<span class="kw-2">&amp;</span><span class="self">self</span>, key: <span class="kw-2">&amp;</span>[u8]) {
        <span class="kw">unsafe </span>{
            fdb_sys::fdb_transaction_clear(
                <span class="self">self</span>.inner.as_ptr(),
                key.as_ptr(),
                fdb_len(key.len(), <span class="string">&quot;key&quot;</span>),
            )
        }
    }

    <span class="doccomment">/// Reads a value from the database snapshot represented by transaction.
    ///
    /// Returns an FDBFuture which will be set to the value of key in the database if there is any.
    ///
    /// # Arguments
    ///
    /// * `key` - the name of the key to be looked up in the database
    /// * `snapshot` - `true` if this is a [snapshot read](https://apple.github.io/foundationdb/api-c.html#snapshots)
    </span><span class="kw">pub fn </span>get(
        <span class="kw-2">&amp;</span><span class="self">self</span>,
        key: <span class="kw-2">&amp;</span>[u8],
        snapshot: bool,
    ) -&gt; <span class="kw">impl </span>Future&lt;Output = FdbResult&lt;<span class="prelude-ty">Option</span>&lt;FdbSlice&gt;&gt;&gt; + Send + Sync + Unpin {
        FdbFuture::new(<span class="kw">unsafe </span>{
            fdb_sys::fdb_transaction_get(
                <span class="self">self</span>.inner.as_ptr(),
                key.as_ptr(),
                fdb_len(key.len(), <span class="string">&quot;key&quot;</span>),
                fdb_bool(snapshot),
            )
        })
    }

    <span class="doccomment">/// Modify the database snapshot represented by transaction to perform the operation indicated
    /// by operationType with operand param to the value stored by the given key.
    ///
    /// An atomic operation is a single database command that carries out several logical steps:
    /// reading the value of a key, performing a transformation on that value, and writing the
    /// result. Different atomic operations perform different transformations. Like other database
    /// operations, an atomic operation is used within a transaction; however, its use within a
    /// transaction will not cause the transaction to conflict.
    ///
    /// Atomic operations do not expose the current value of the key to the client but simply send
    /// the database the transformation to apply. In regard to conflict checking, an atomic
    /// operation is equivalent to a write without a read. It can only cause other transactions
    /// performing reads of the key to conflict.
    ///
    /// By combining these logical steps into a single, read-free operation, FoundationDB can
    /// guarantee that the transaction will not conflict due to the operation. This makes atomic
    /// operations ideal for operating on keys that are frequently modified. A common example is
    /// the use of a key-value pair as a counter.
    ///
    /// # Warning
    ///
    /// If a transaction uses both an atomic operation and a strictly serializable read on the same
    /// key, the benefits of using the atomic operation (for both conflict checking and performance)
    /// are lost.
    </span><span class="kw">pub fn </span>atomic_op(<span class="kw-2">&amp;</span><span class="self">self</span>, key: <span class="kw-2">&amp;</span>[u8], param: <span class="kw-2">&amp;</span>[u8], op_type: options::MutationType) {
        <span class="kw">unsafe </span>{
            fdb_sys::fdb_transaction_atomic_op(
                <span class="self">self</span>.inner.as_ptr(),
                key.as_ptr(),
                fdb_len(key.len(), <span class="string">&quot;key&quot;</span>),
                param.as_ptr(),
                fdb_len(param.len(), <span class="string">&quot;param&quot;</span>),
                op_type.code(),
            )
        }
    }

    <span class="doccomment">/// Resolves a key selector against the keys in the database snapshot represented by
    /// transaction.
    ///
    /// Returns an FDBFuture which will be set to the key in the database matching the key
    /// selector.
    ///
    /// # Arguments
    ///
    /// * `selector`: the key selector
    /// * `snapshot`: `true` if this is a [snapshot read](https://apple.github.io/foundationdb/api-c.html#snapshots)
    </span><span class="kw">pub fn </span>get_key(
        <span class="kw-2">&amp;</span><span class="self">self</span>,
        selector: <span class="kw-2">&amp;</span>KeySelector,
        snapshot: bool,
    ) -&gt; <span class="kw">impl </span>Future&lt;Output = FdbResult&lt;FdbSlice&gt;&gt; + Send + Sync + Unpin {
        <span class="kw">let </span>key = selector.key();
        FdbFuture::new(<span class="kw">unsafe </span>{
            fdb_sys::fdb_transaction_get_key(
                <span class="self">self</span>.inner.as_ptr(),
                key.as_ptr(),
                fdb_len(key.len(), <span class="string">&quot;key&quot;</span>),
                fdb_bool(selector.or_equal()),
                selector.offset(),
                fdb_bool(snapshot),
            )
        })
    }

    <span class="doccomment">/// Reads all key-value pairs in the database snapshot represented by transaction (potentially
    /// limited by limit, target_bytes, or mode) which have a key lexicographically greater than or
    /// equal to the key resolved by the begin key selector and lexicographically less than the key
    /// resolved by the end key selector.
    ///
    /// Returns a stream of KeyValue slices.
    ///
    /// This method is a little more efficient than `get_ranges_keyvalues` but a little harder to
    /// use.
    ///
    /// # Arguments
    ///
    /// * `opt`: the range, limit, target_bytes and mode
    /// * `snapshot`: `true` if this is a [snapshot read](https://apple.github.io/foundationdb/api-c.html#snapshots)
    </span><span class="kw">pub fn </span>get_ranges&lt;<span class="lifetime">&#39;a</span>&gt;(
        <span class="kw-2">&amp;</span><span class="lifetime">&#39;a </span><span class="self">self</span>,
        opt: RangeOption&lt;<span class="lifetime">&#39;a</span>&gt;,
        snapshot: bool,
    ) -&gt; <span class="kw">impl </span>Stream&lt;Item = FdbResult&lt;FdbValues&gt;&gt; + Send + Sync + Unpin + <span class="lifetime">&#39;a </span>{
        stream::unfold((<span class="number">1</span>, <span class="prelude-val">Some</span>(opt)), <span class="kw">move </span>|(iteration, maybe_opt)| {
            <span class="kw">if let </span><span class="prelude-val">Some</span>(opt) = maybe_opt {
                Either::Left(<span class="self">self</span>.get_range(<span class="kw-2">&amp;</span>opt, iteration <span class="kw">as </span>usize, snapshot).map(
                    <span class="kw">move </span>|maybe_values| {
                        <span class="kw">let </span>next_opt = <span class="kw">match </span><span class="kw-2">&amp;</span>maybe_values {
                            <span class="prelude-val">Ok</span>(values) =&gt; opt.next_range(values),
                            <span class="prelude-val">Err</span>(..) =&gt; <span class="prelude-val">None</span>,
                        };
                        <span class="prelude-val">Some</span>((maybe_values, (iteration + <span class="number">1</span>, next_opt)))
                    },
                ))
            } <span class="kw">else </span>{
                Either::Right(future::ready(<span class="prelude-val">None</span>))
            }
        })
    }

    <span class="doccomment">/// Reads all key-value pairs in the database snapshot represented by transaction (potentially
    /// limited by limit, target_bytes, or mode) which have a key lexicographically greater than or
    /// equal to the key resolved by the begin key selector and lexicographically less than the key
    /// resolved by the end key selector.
    ///
    /// Returns a stream of KeyValue.
    ///
    /// # Arguments
    ///
    /// * `opt`: the range, limit, target_bytes and mode
    /// * `snapshot`: `true` if this is a [snapshot read](https://apple.github.io/foundationdb/api-c.html#snapshots)
    </span><span class="kw">pub fn </span>get_ranges_keyvalues&lt;<span class="lifetime">&#39;a</span>&gt;(
        <span class="kw-2">&amp;</span><span class="lifetime">&#39;a </span><span class="self">self</span>,
        opt: RangeOption&lt;<span class="lifetime">&#39;a</span>&gt;,
        snapshot: bool,
    ) -&gt; <span class="kw">impl </span>Stream&lt;Item = FdbResult&lt;FdbValue&gt;&gt; + Unpin + <span class="lifetime">&#39;a </span>{
        <span class="self">self</span>.get_ranges(opt, snapshot)
            .map_ok(|values| stream::iter(values.into_iter().map(<span class="prelude-val">Ok</span>)))
            .try_flatten()
    }

    <span class="doccomment">/// Reads all key-value pairs in the database snapshot represented by transaction (potentially
    /// limited by limit, target_bytes, or mode) which have a key lexicographically greater than or
    /// equal to the key resolved by the begin key selector and lexicographically less than the key
    /// resolved by the end key selector.
    ///
    /// # Arguments
    ///
    /// * `opt`: the range, limit, target_bytes and mode
    /// * `iteration`: If opt.mode is Iterator, this parameter should start at 1 and be incremented
    ///   by 1 for each successive call while reading this range. In all other cases it is ignored.
    /// * `snapshot`: `true` if this is a [snapshot read](https://apple.github.io/foundationdb/api-c.html#snapshots)
    </span><span class="kw">pub fn </span>get_range(
        <span class="kw-2">&amp;</span><span class="self">self</span>,
        opt: <span class="kw-2">&amp;</span>RangeOption,
        iteration: usize,
        snapshot: bool,
    ) -&gt; <span class="kw">impl </span>Future&lt;Output = FdbResult&lt;FdbValues&gt;&gt; + Send + Sync + Unpin {
        <span class="kw">let </span>begin = <span class="kw-2">&amp;</span>opt.begin;
        <span class="kw">let </span>end = <span class="kw-2">&amp;</span>opt.end;
        <span class="kw">let </span>key_begin = begin.key();
        <span class="kw">let </span>key_end = end.key();

        FdbFuture::new(<span class="kw">unsafe </span>{
            fdb_sys::fdb_transaction_get_range(
                <span class="self">self</span>.inner.as_ptr(),
                key_begin.as_ptr(),
                fdb_len(key_begin.len(), <span class="string">&quot;key_begin&quot;</span>),
                fdb_bool(begin.or_equal()),
                begin.offset(),
                key_end.as_ptr(),
                fdb_len(key_end.len(), <span class="string">&quot;key_end&quot;</span>),
                fdb_bool(end.or_equal()),
                end.offset(),
                fdb_limit(opt.limit.unwrap_or(<span class="number">0</span>)),
                fdb_limit(opt.target_bytes),
                opt.mode.code(),
                fdb_iteration(iteration),
                fdb_bool(snapshot),
                fdb_bool(opt.reverse),
            )
        })
    }

    <span class="doccomment">/// Mapped Range is an experimental feature introduced in FDB 7.1.
    /// It is intended to improve the client throughput and reduce latency for querying data through a Subspace used as a &quot;index&quot;.
    /// In such a case, querying records by scanning an index in relational databases can be
    /// translated to a GetRange request on the index entries followed up by multiple GetValue requests for the record entries in FDB.
    ///
    /// This method is allowing FoundationDB &quot;follow up&quot; a GetRange request with GetValue requests,
    /// this can happen in one request without additional back and forth. Considering the overhead
    /// of each request, this saves time and resources on serialization, deserialization, and network.
    ///
    /// A mapped request will:
    ///
    /// * Do a range query (same as a `Transaction.get_range` request) and get the result. We call it the primary query.
    /// * For each key-value pair in the primary query result, translate it to a `get_range` query and get the result. We call them secondary queries.
    /// * Put all results in a nested structure and return them.
    ///
    /// **WARNING** : This feature is considered experimental at this time. It is only allowed when
    /// using snapshot isolation AND disabling read-your-writes.
    ///
    /// More info can be found in the relevant [documentation](https://github.com/apple/foundationdb/wiki/Everything-about-GetMappedRange#input).
    ///
    /// This is the &quot;raw&quot; version, users are expected to use [Transaction::get_mapped_ranges]
    </span><span class="attribute">#[cfg_api_versions(min = <span class="number">710</span>)]
    </span><span class="kw">pub fn </span>get_mapped_range&lt;<span class="lifetime">&#39;a</span>&gt;(
        <span class="kw-2">&amp;</span><span class="lifetime">&#39;a </span><span class="self">self</span>,
        opt: <span class="kw-2">&amp;</span>RangeOption,
        mapper: <span class="kw-2">&amp;</span>[u8],
        iteration: usize,
        snapshot: bool,
    ) -&gt; <span class="kw">impl </span>Future&lt;Output = FdbResult&lt;MappedKeyValues&gt;&gt; + Send + Sync + Unpin {
        <span class="kw">let </span>begin = <span class="kw-2">&amp;</span>opt.begin;
        <span class="kw">let </span>end = <span class="kw-2">&amp;</span>opt.end;
        <span class="kw">let </span>key_begin = begin.key();
        <span class="kw">let </span>key_end = end.key();

        FdbFuture::new(<span class="kw">unsafe </span>{
            fdb_sys::fdb_transaction_get_mapped_range(
                <span class="self">self</span>.inner.as_ptr(),
                key_begin.as_ptr(),
                fdb_len(key_begin.len(), <span class="string">&quot;key_begin&quot;</span>),
                fdb_bool(begin.or_equal()),
                begin.offset(),
                key_end.as_ptr(),
                fdb_len(key_end.len(), <span class="string">&quot;key_end&quot;</span>),
                fdb_bool(end.or_equal()),
                end.offset(),
                mapper.as_ptr(),
                fdb_len(mapper.len(), <span class="string">&quot;mapper_length&quot;</span>),
                fdb_limit(opt.limit.unwrap_or(<span class="number">0</span>)),
                fdb_limit(opt.target_bytes),
                opt.mode.code(),
                fdb_iteration(iteration),
                fdb_bool(snapshot),
                fdb_bool(opt.reverse),
            )
        })
    }

    <span class="doccomment">/// Mapped Range is an experimental feature introduced in FDB 7.1.
    /// It is intended to improve the client throughput and reduce latency for querying data through a Subspace used as a &quot;index&quot;.
    /// In such a case, querying records by scanning an index in relational databases can be
    /// translated to a GetRange request on the index entries followed up by multiple GetValue requests for the record entries in FDB.
    ///
    /// This method is allowing FoundationDB &quot;follow up&quot; a GetRange request with GetValue requests,
    /// this can happen in one request without additional back and forth. Considering the overhead
    /// of each request, this saves time and resources on serialization, deserialization, and network.
    ///
    /// A mapped request will:
    ///
    /// * Do a range query (same as a `Transaction.get_range` request) and get the result. We call it the primary query.
    /// * For each key-value pair in the primary query result, translate it to a `get_range` query and get the result. We call them secondary queries.
    /// * Put all results in a nested structure and return them.
    ///
    /// **WARNING** : This feature is considered experimental at this time. It is only allowed when
    /// using snapshot isolation AND disabling read-your-writes.
    ///
    /// More info can be found in the relevant [documentation](https://github.com/apple/foundationdb/wiki/Everything-about-GetMappedRange#input).
    </span><span class="attribute">#[cfg_api_versions(min = <span class="number">710</span>)]
    </span><span class="kw">pub fn </span>get_mapped_ranges&lt;<span class="lifetime">&#39;a</span>&gt;(
        <span class="kw-2">&amp;</span><span class="lifetime">&#39;a </span><span class="self">self</span>,
        opt: RangeOption&lt;<span class="lifetime">&#39;a</span>&gt;,
        mapper: <span class="kw-2">&amp;</span><span class="lifetime">&#39;a </span>[u8],
        snapshot: bool,
    ) -&gt; <span class="kw">impl </span>Stream&lt;Item = FdbResult&lt;MappedKeyValues&gt;&gt; + Send + Sync + Unpin + <span class="lifetime">&#39;a </span>{
        stream::unfold((<span class="number">1</span>, <span class="prelude-val">Some</span>(opt)), <span class="kw">move </span>|(iteration, maybe_opt)| {
            <span class="kw">if let </span><span class="prelude-val">Some</span>(opt) = maybe_opt {
                Either::Left(
                    <span class="self">self</span>.get_mapped_range(<span class="kw-2">&amp;</span>opt, mapper, iteration <span class="kw">as </span>usize, snapshot)
                        .map(<span class="kw">move </span>|maybe_values| {
                            <span class="kw">let </span>next_opt = <span class="kw">match </span><span class="kw-2">&amp;</span>maybe_values {
                                <span class="prelude-val">Ok</span>(values) =&gt; opt.next_mapped_range(values),
                                <span class="prelude-val">Err</span>(..) =&gt; <span class="prelude-val">None</span>,
                            };
                            <span class="prelude-val">Some</span>((maybe_values, (iteration + <span class="number">1</span>, next_opt)))
                        }),
                )
            } <span class="kw">else </span>{
                Either::Right(future::ready(<span class="prelude-val">None</span>))
            }
        })
    }

    <span class="doccomment">/// Modify the database snapshot represented by transaction to remove all keys (if any) which
    /// are lexicographically greater than or equal to the given begin key and lexicographically
    /// less than the given end_key.
    ///
    /// The modification affects the actual database only if transaction is later committed with
    /// `Transaction::commit`.
    </span><span class="kw">pub fn </span>clear_range(<span class="kw-2">&amp;</span><span class="self">self</span>, begin: <span class="kw-2">&amp;</span>[u8], end: <span class="kw-2">&amp;</span>[u8]) {
        <span class="kw">unsafe </span>{
            fdb_sys::fdb_transaction_clear_range(
                <span class="self">self</span>.inner.as_ptr(),
                begin.as_ptr(),
                fdb_len(begin.len(), <span class="string">&quot;begin&quot;</span>),
                end.as_ptr(),
                fdb_len(end.len(), <span class="string">&quot;end&quot;</span>),
            )
        }
    }

    <span class="doccomment">/// Get the estimated byte size of the key range based on the byte sample collected by FDB
    </span><span class="attribute">#[cfg_api_versions(min = <span class="number">630</span>)]
    </span><span class="kw">pub fn </span>get_estimated_range_size_bytes(
        <span class="kw-2">&amp;</span><span class="self">self</span>,
        begin: <span class="kw-2">&amp;</span>[u8],
        end: <span class="kw-2">&amp;</span>[u8],
    ) -&gt; <span class="kw">impl </span>Future&lt;Output = FdbResult&lt;i64&gt;&gt; + Send + Sync + Unpin {
        FdbFuture::&lt;i64&gt;::new(<span class="kw">unsafe </span>{
            fdb_sys::fdb_transaction_get_estimated_range_size_bytes(
                <span class="self">self</span>.inner.as_ptr(),
                begin.as_ptr(),
                fdb_len(begin.len(), <span class="string">&quot;begin&quot;</span>),
                end.as_ptr(),
                fdb_len(end.len(), <span class="string">&quot;end&quot;</span>),
            )
        })
    }

    <span class="doccomment">/// Attempts to commit the sets and clears previously applied to the database snapshot
    /// represented by transaction to the actual database.
    ///
    /// The commit may or may not succeed – in particular, if a conflicting transaction previously
    /// committed, then the commit must fail in order to preserve transactional isolation. If the
    /// commit does succeed, the transaction is durably committed to the database and all
    /// subsequently started transactions will observe its effects.
    ///
    /// It is not necessary to commit a read-only transaction – you can simply drop it.
    ///
    /// Callers will usually want to retry a transaction if the commit or a another method on the
    /// transaction returns a retryable error (see `on_error` and/or `Database::transact`).
    ///
    /// As with other client/server databases, in some failure scenarios a client may be unable to
    /// determine whether a transaction succeeded. In these cases, `Transaction::commit` will return
    /// an error and `is_maybe_committed()` will returns true on that error. The `on_error` function
    /// treats this error as retryable, so retry loops that don’t check for `is_maybe_committed()`
    /// could execute the transaction twice. In these cases, you must consider the idempotence of
    /// the transaction. For more information, see [Transactions with unknown results](https://apple.github.io/foundationdb/developer-guide.html#developer-guide-unknown-results).
    ///
    /// Normally, commit will wait for outstanding reads to return. However, if those reads were
    /// snapshot reads or the transaction option for disabling “read-your-writes” has been invoked,
    /// any outstanding reads will immediately return errors.
    </span><span class="kw">pub fn </span>commit(<span class="self">self</span>) -&gt; <span class="kw">impl </span>Future&lt;Output = TransactionResult&gt; + Send + Sync + Unpin {
        FdbFuture::&lt;()&gt;::new(<span class="kw">unsafe </span>{ fdb_sys::fdb_transaction_commit(<span class="self">self</span>.inner.as_ptr()) }).map(
            <span class="kw">move </span>|r| <span class="kw">match </span>r {
                <span class="prelude-val">Ok</span>(()) =&gt; <span class="prelude-val">Ok</span>(TransactionCommitted { tr: <span class="self">self </span>}),
                <span class="prelude-val">Err</span>(err) =&gt; <span class="prelude-val">Err</span>(TransactionCommitError { tr: <span class="self">self</span>, err }),
            },
        )
    }

    <span class="doccomment">/// Implements the recommended retry and backoff behavior for a transaction. This function knows
    /// which of the error codes generated by other `Transaction` functions represent temporary
    /// error conditions and which represent application errors that should be handled by the
    /// application. It also implements an exponential backoff strategy to avoid swamping the
    /// database cluster with excessive retries when there is a high level of conflict between
    /// transactions.
    ///
    /// It is not necessary to call `reset()` when handling an error with `on_error()` since the
    /// transaction has already been reset.
    ///
    /// You should not call this method most of the times and use `Database::transact` which
    /// implements a retry loop strategy for you.
    </span><span class="kw">pub fn </span>on_error(
        <span class="self">self</span>,
        err: FdbError,
    ) -&gt; <span class="kw">impl </span>Future&lt;Output = FdbResult&lt;Transaction&gt;&gt; + Send + Sync + Unpin {
        FdbFuture::&lt;()&gt;::new(<span class="kw">unsafe </span>{
            fdb_sys::fdb_transaction_on_error(<span class="self">self</span>.inner.as_ptr(), err.code())
        })
        .map_ok(|()| <span class="self">self</span>)
    }

    <span class="doccomment">/// Cancels the transaction. All pending or future uses of the transaction will return a
    /// transaction_cancelled error. The transaction can be used again after it is reset.
    </span><span class="kw">pub fn </span>cancel(<span class="self">self</span>) -&gt; TransactionCancelled {
        <span class="kw">unsafe </span>{ fdb_sys::fdb_transaction_cancel(<span class="self">self</span>.inner.as_ptr()) };
        TransactionCancelled { tr: <span class="self">self </span>}
    }

    <span class="doccomment">/// Returns a list of public network addresses as strings, one for each of the storage servers
    /// responsible for storing key_name and its associated value.
    </span><span class="kw">pub fn </span>get_addresses_for_key(
        <span class="kw-2">&amp;</span><span class="self">self</span>,
        key: <span class="kw-2">&amp;</span>[u8],
    ) -&gt; <span class="kw">impl </span>Future&lt;Output = FdbResult&lt;FdbAddresses&gt;&gt; + Send + Sync + Unpin {
        FdbFuture::new(<span class="kw">unsafe </span>{
            fdb_sys::fdb_transaction_get_addresses_for_key(
                <span class="self">self</span>.inner.as_ptr(),
                key.as_ptr(),
                fdb_len(key.len(), <span class="string">&quot;key&quot;</span>),
            )
        })
    }

    <span class="doccomment">/// A watch&#39;s behavior is relative to the transaction that created it. A watch will report a
    /// change in relation to the key’s value as readable by that transaction. The initial value
    /// used for comparison is either that of the transaction’s read version or the value as
    /// modified by the transaction itself prior to the creation of the watch. If the value changes
    /// and then changes back to its initial value, the watch might not report the change.
    ///
    /// Until the transaction that created it has been committed, a watch will not report changes
    /// made by other transactions. In contrast, a watch will immediately report changes made by
    /// the transaction itself. Watches cannot be created if the transaction has set the
    /// READ_YOUR_WRITES_DISABLE transaction option, and an attempt to do so will return an
    /// watches_disabled error.
    ///
    /// If the transaction used to create a watch encounters an error during commit, then the watch
    /// will be set with that error. A transaction whose commit result is unknown will set all of
    /// its watches with the commit_unknown_result error. If an uncommitted transaction is reset or
    /// destroyed, then any watches it created will be set with the transaction_cancelled error.
    ///
    /// Returns an future representing an empty value that will be set once the watch has
    /// detected a change to the value at the specified key.
    ///
    /// By default, each database connection can have no more than 10,000 watches that have not yet
    /// reported a change. When this number is exceeded, an attempt to create a watch will return a
    /// too_many_watches error. This limit can be changed using the MAX_WATCHES database option.
    /// Because a watch outlives the transaction that creates it, any watch that is no longer
    /// needed should be cancelled by dropping its future.
    </span><span class="kw">pub fn </span>watch(<span class="kw-2">&amp;</span><span class="self">self</span>, key: <span class="kw-2">&amp;</span>[u8]) -&gt; <span class="kw">impl </span>Future&lt;Output = FdbResult&lt;()&gt;&gt; + Send + Sync + Unpin {
        FdbFuture::new(<span class="kw">unsafe </span>{
            fdb_sys::fdb_transaction_watch(
                <span class="self">self</span>.inner.as_ptr(),
                key.as_ptr(),
                fdb_len(key.len(), <span class="string">&quot;key&quot;</span>),
            )
        })
    }

    <span class="doccomment">/// Returns an FDBFuture which will be set to the approximate transaction size so far in the
    /// returned future, which is the summation of the estimated size of mutations, read conflict
    /// ranges, and write conflict ranges.
    ///
    /// This can be called multiple times before the transaction is committed.
    </span><span class="attribute">#[cfg_api_versions(min = <span class="number">620</span>)]
    </span><span class="kw">pub fn </span>get_approximate_size(
        <span class="kw-2">&amp;</span><span class="self">self</span>,
    ) -&gt; <span class="kw">impl </span>Future&lt;Output = FdbResult&lt;i64&gt;&gt; + Send + Sync + Unpin {
        FdbFuture::new(<span class="kw">unsafe </span>{
            fdb_sys::fdb_transaction_get_approximate_size(<span class="self">self</span>.inner.as_ptr())
        })
    }

    <span class="doccomment">/// Gets a list of keys that can split the given range into (roughly) equally sized chunks based on chunk_size.
    /// Note: the returned split points contain the start key and end key of the given range.
    </span><span class="attribute">#[cfg_api_versions(min = <span class="number">700</span>)]
    </span><span class="kw">pub fn </span>get_range_split_points(
        <span class="kw-2">&amp;</span><span class="self">self</span>,
        begin: <span class="kw-2">&amp;</span>[u8],
        end: <span class="kw-2">&amp;</span>[u8],
        chunk_size: i64,
    ) -&gt; <span class="kw">impl </span>Future&lt;Output = FdbResult&lt;FdbKeys&gt;&gt; + Send + Sync + Unpin {
        FdbFuture::&lt;FdbKeys&gt;::new(<span class="kw">unsafe </span>{
            fdb_sys::fdb_transaction_get_range_split_points(
                <span class="self">self</span>.inner.as_ptr(),
                begin.as_ptr(),
                fdb_len(begin.len(), <span class="string">&quot;begin&quot;</span>),
                end.as_ptr(),
                fdb_len(end.len(), <span class="string">&quot;end&quot;</span>),
                chunk_size,
            )
        })
    }

    <span class="doccomment">/// Returns an FDBFuture which will be set to the versionstamp which was used by any
    /// versionstamp operations in this transaction.
    ///
    /// The future will be ready only after the successful completion of a call to `commit()` on
    /// this Transaction. Read-only transactions do not modify the database when committed and will
    /// result in the future completing with an error. Keep in mind that a transaction which reads
    /// keys and then sets them to their current values may be optimized to a read-only transaction.
    ///
    /// Most applications will not call this function.
    </span><span class="kw">pub fn </span>get_versionstamp(
        <span class="kw-2">&amp;</span><span class="self">self</span>,
    ) -&gt; <span class="kw">impl </span>Future&lt;Output = FdbResult&lt;FdbSlice&gt;&gt; + Send + Sync + Unpin {
        FdbFuture::new(<span class="kw">unsafe </span>{ fdb_sys::fdb_transaction_get_versionstamp(<span class="self">self</span>.inner.as_ptr()) })
    }

    <span class="doccomment">/// The transaction obtains a snapshot read version automatically at the time of the first call
    /// to `get_*()` (including this one) and (unless causal consistency has been deliberately
    /// compromised by transaction options) is guaranteed to represent all transactions which were
    /// reported committed before that call.
    </span><span class="kw">pub fn </span>get_read_version(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; <span class="kw">impl </span>Future&lt;Output = FdbResult&lt;i64&gt;&gt; + Send + Sync + Unpin {
        FdbFuture::new(<span class="kw">unsafe </span>{ fdb_sys::fdb_transaction_get_read_version(<span class="self">self</span>.inner.as_ptr()) })
    }

    <span class="doccomment">/// Sets the snapshot read version used by a transaction.
    ///
    /// This is not needed in simple cases.
    /// If the given version is too old, subsequent reads will fail with error_code_past_version;
    /// if it is too new, subsequent reads may be delayed indefinitely and/or fail with
    /// error_code_future_version. If any of get_*() have been called on this transaction already,
    /// the result is undefined.
    </span><span class="kw">pub fn </span>set_read_version(<span class="kw-2">&amp;</span><span class="self">self</span>, version: i64) {
        <span class="kw">unsafe </span>{ fdb_sys::fdb_transaction_set_read_version(<span class="self">self</span>.inner.as_ptr(), version) }
    }

    <span class="doccomment">/// The metadata version key `\xff/metadataVersion` is a key intended to help layers deal with hot keys.
    /// The value of this key is sent to clients along with the read version from the proxy,
    /// so a client can read its value without communicating with a storage server.
    /// To retrieve the metadataVersion, you need to set `TransactionOption::ReadSystemKeys`
    </span><span class="attribute">#[cfg_api_versions(min = <span class="number">610</span>)]
    </span><span class="kw">pub async fn </span>get_metadata_version(<span class="kw-2">&amp;</span><span class="self">self</span>, snapshot: bool) -&gt; FdbResult&lt;<span class="prelude-ty">Option</span>&lt;i64&gt;&gt; {
        <span class="kw">match </span><span class="self">self</span>.get(METADATA_VERSION_KEY, snapshot).<span class="kw">await </span>{
            <span class="prelude-val">Ok</span>(<span class="prelude-val">Some</span>(fdb_slice)) =&gt; {
                <span class="kw">let </span>value = fdb_slice.deref();
                <span class="comment">// as we cannot write the metadata-key directly(we must mutate with an atomic_op),
                // can we assume that it will always be the correct size?
                </span><span class="kw">if </span>value.len() &lt; <span class="number">8 </span>{
                    <span class="kw">return </span><span class="prelude-val">Ok</span>(<span class="prelude-val">None</span>);
                }

                <span class="comment">// The 80-bits versionstamps are 10 bytes longs, and are composed of:
                // * 8 bytes (Transaction Version)
                // * followed by 2 bytes (Transaction Batch Order)
                // More details can be found here: https://forums.foundationdb.org/t/implementing-versionstamps-in-bindings/250
                </span><span class="kw">let </span><span class="kw-2">mut </span>arr = [<span class="number">0u8</span>; <span class="number">8</span>];
                arr.copy_from_slice(<span class="kw-2">&amp;</span>value[<span class="number">0</span>..<span class="number">8</span>]);
                <span class="kw">let </span>transaction_version: i64 = i64::from_be_bytes(arr);

                <span class="prelude-val">Ok</span>(<span class="prelude-val">Some</span>(transaction_version))
            }
            <span class="prelude-val">Ok</span>(<span class="prelude-val">None</span>) =&gt; <span class="prelude-val">Ok</span>(<span class="prelude-val">None</span>),

            <span class="prelude-val">Err</span>(err) =&gt; <span class="prelude-val">Err</span>(err),
        }
    }

    <span class="attribute">#[cfg_api_versions(min = <span class="number">610</span>)]
    </span><span class="kw">pub fn </span>update_metadata_version(<span class="kw-2">&amp;</span><span class="self">self</span>) {
        <span class="comment">// The param is transformed by removing the final four bytes from ``param`` and reading
        // those as a little-Endian 32-bit integer to get a position ``pos``.
        // The 10 bytes of the parameter from ``pos`` to ``pos + 10`` are replaced with the
        // versionstamp of the transaction used. The first byte of the parameter is position 0.
        // As we only have the metadata value, we can just create an 14-bytes Vec filled with 0u8.
        </span><span class="kw">let </span>param = <span class="macro">vec!</span>[<span class="number">0u8</span>; <span class="number">14</span>];
        <span class="self">self</span>.atomic_op(
            METADATA_VERSION_KEY,
            param.as_slice(),
            options::MutationType::SetVersionstampedValue,
        )
    }

    <span class="doccomment">/// Reset transaction to its initial state.
    ///
    /// In order to protect against a race condition with cancel(), this call require a mutable
    /// access to the transaction.
    ///
    /// This is similar to dropping the transaction and creating a new one.
    ///
    /// It is not necessary to call `reset()` when handling an error with `on_error()` since the
    /// transaction has already been reset.
    </span><span class="kw">pub fn </span>reset(<span class="kw-2">&amp;mut </span><span class="self">self</span>) {
        <span class="kw">unsafe </span>{ fdb_sys::fdb_transaction_reset(<span class="self">self</span>.inner.as_ptr()) }
    }

    <span class="doccomment">/// Adds a conflict range to a transaction without performing the associated read or write.
    ///
    /// # Note
    ///
    /// Most applications will use the serializable isolation that transactions provide by default
    /// and will not need to manipulate conflict ranges.
    </span><span class="kw">pub fn </span>add_conflict_range(
        <span class="kw-2">&amp;</span><span class="self">self</span>,
        begin: <span class="kw-2">&amp;</span>[u8],
        end: <span class="kw-2">&amp;</span>[u8],
        ty: options::ConflictRangeType,
    ) -&gt; FdbResult&lt;()&gt; {
        error::eval(<span class="kw">unsafe </span>{
            fdb_sys::fdb_transaction_add_conflict_range(
                <span class="self">self</span>.inner.as_ptr(),
                begin.as_ptr(),
                fdb_len(begin.len(), <span class="string">&quot;begin&quot;</span>),
                end.as_ptr(),
                fdb_len(end.len(), <span class="string">&quot;end&quot;</span>),
                ty.code(),
            )
        })
    }
}

<span class="kw">impl </span>Drop <span class="kw">for </span>Transaction {
    <span class="kw">fn </span>drop(<span class="kw-2">&amp;mut </span><span class="self">self</span>) {
        <span class="kw">unsafe </span>{
            fdb_sys::fdb_transaction_destroy(<span class="self">self</span>.inner.as_ptr());
        }
    }
}

<span class="doccomment">/// A retryable transaction, generated by Database.run
</span><span class="attribute">#[derive(Clone)]
</span><span class="kw">pub struct </span>RetryableTransaction {
    inner: Arc&lt;Transaction&gt;,
}

<span class="kw">impl </span>Deref <span class="kw">for </span>RetryableTransaction {
    <span class="kw">type </span>Target = Transaction;
    <span class="kw">fn </span>deref(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; <span class="kw-2">&amp;</span>Transaction {
        <span class="self">self</span>.inner.deref()
    }
}

<span class="kw">impl </span>RetryableTransaction {
    <span class="kw">pub</span>(<span class="kw">crate</span>) <span class="kw">fn </span>new(t: Transaction) -&gt; RetryableTransaction {
        RetryableTransaction { inner: Arc::new(t) }
    }

    <span class="kw">pub</span>(<span class="kw">crate</span>) <span class="kw">fn </span>take(<span class="self">self</span>) -&gt; <span class="prelude-ty">Result</span>&lt;Transaction, FdbBindingError&gt; {
        <span class="comment">// checking weak references
        </span><span class="kw">if </span>Arc::weak_count(<span class="kw-2">&amp;</span><span class="self">self</span>.inner) != <span class="number">0 </span>{
            <span class="kw">return </span><span class="prelude-val">Err</span>(FdbBindingError::ReferenceToTransactionKept);
        }
        Arc::try_unwrap(<span class="self">self</span>.inner).map_err(|<span class="kw">_</span>| FdbBindingError::ReferenceToTransactionKept)
    }

    <span class="kw">pub</span>(<span class="kw">crate</span>) <span class="kw">async fn </span>on_error(
        <span class="self">self</span>,
        err: FdbError,
    ) -&gt; <span class="prelude-ty">Result</span>&lt;<span class="prelude-ty">Result</span>&lt;RetryableTransaction, FdbError&gt;, FdbBindingError&gt; {
        <span class="prelude-val">Ok</span>(<span class="self">self
            </span>.take()<span class="question-mark">?
            </span>.on_error(err)
            .<span class="kw">await
            </span>.map(RetryableTransaction::new))
    }

    <span class="kw">pub</span>(<span class="kw">crate</span>) <span class="kw">async fn </span>commit(
        <span class="self">self</span>,
    ) -&gt; <span class="prelude-ty">Result</span>&lt;<span class="prelude-ty">Result</span>&lt;TransactionCommitted, TransactionCommitError&gt;, FdbBindingError&gt; {
        <span class="prelude-val">Ok</span>(<span class="self">self</span>.take()<span class="question-mark">?</span>.commit().<span class="kw">await</span>)
    }
}
</code></pre></div>
</section></div></main><div id="rustdoc-vars" data-root-path="../../" data-current-crate="foundationdb" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.65.0 (897e37553 2022-11-02)" ></div></body></html>